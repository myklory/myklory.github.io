<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="TC275时钟系统"><meta name="keywords" content="tricore,TC275"><meta name="author" content="Myklory"><meta name="copyright" content="Myklory"><title>TC275时钟系统 | 年年有鱼</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#时钟源"><span class="toc-number">1.</span> <span class="toc-text"> 时钟源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#振荡电路"><span class="toc-number">1.1.</span> <span class="toc-text"> 振荡电路</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#外部时钟输入模式"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 外部时钟输入模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#时钟振荡电路"><span class="toc-number">1.1.2.</span> <span class="toc-text"> 时钟振荡电路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#振荡电路控制寄存器"><span class="toc-number">1.1.3.</span> <span class="toc-text"> 振荡电路控制寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#通过ssw进行配置"><span class="toc-number">1.1.3.1.</span> <span class="toc-text"> 通过SSW进行配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#在ssw之后进行配置"><span class="toc-number">1.1.3.2.</span> <span class="toc-text"> 在SSW之后进行配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xtal1作为一般的输入针脚"><span class="toc-number">1.1.3.3.</span> <span class="toc-text"> XTAL1作为一般的输入针脚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#振荡器看门狗"><span class="toc-number">1.1.3.4.</span> <span class="toc-text"> 振荡器看门狗</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#备用时钟源"><span class="toc-number">1.2.</span> <span class="toc-text"> 备用时钟源</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时钟倍频"><span class="toc-number">2.</span> <span class="toc-text"> 时钟倍频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pll"><span class="toc-number">2.1.</span> <span class="toc-text"> PLL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pll功能描述"><span class="toc-number">2.1.1.</span> <span class="toc-text"> PLL功能描述</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#一般模式"><span class="toc-number">2.1.1.1.</span> <span class="toc-text"> 一般模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#预分频模式"><span class="toc-number">2.1.1.2.</span> <span class="toc-text"> 预分频模式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#自由运行模式"><span class="toc-number">2.1.1.3.</span> <span class="toc-text"> 自由运行模式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pll_eray"><span class="toc-number">2.2.</span> <span class="toc-text"> PLL_ERAY</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分频"><span class="toc-number">3.</span> <span class="toc-text"> 分频</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#时钟控制单元ccu"><span class="toc-number">3.1.</span> <span class="toc-text"> 时钟控制单元（CCU）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#时钟分频器的限制"><span class="toc-number">3.2.</span> <span class="toc-text"> 时钟分频器的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ccu寄存器"><span class="toc-number">3.3.</span> <span class="toc-text"> CCU寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#各子模块默认总线频率"><span class="toc-number">3.4.</span> <span class="toc-text"> 各子模块默认总线频率</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#单独的时钟生成"><span class="toc-number">4.</span> <span class="toc-text"> 单独的时钟生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#时钟控制寄存器clc"><span class="toc-number">4.1.</span> <span class="toc-text"> 时钟控制寄存器(CLC)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#模块开关控制"><span class="toc-number">4.1.1.</span> <span class="toc-text"> 模块开关控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#睡眠模式"><span class="toc-number">4.1.2.</span> <span class="toc-text"> 睡眠模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#进入禁用模式"><span class="toc-number">4.1.3.</span> <span class="toc-text"> 进入禁用模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#模块时钟分频器"><span class="toc-number">4.1.4.</span> <span class="toc-text"> 模块时钟分频器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时钟监视"><span class="toc-number">5.</span> <span class="toc-text"> 时钟监视</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时钟的紧急行为"><span class="toc-number">6.</span> <span class="toc-text"> 时钟的紧急行为</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#外部时钟输出"><span class="toc-number">7.</span> <span class="toc-text"> 外部时钟输出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#时钟生成单元cgu"><span class="toc-number">8.</span> <span class="toc-text"> 时钟生成单元CGU</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Myklory</div><div class="author-info__description text-center">总有一天，我们会感谢我们曾经付出的努力！</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">3</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">5</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">2</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://w.wallhaven.cc/full/ox/wallhaven-oxv8pm.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">年年有鱼</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">TC275时钟系统</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-02-11</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/tricore/">tricore</a><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3k</span><span class="post-meta__separator">|</span><span>阅读时长: 10 分钟</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>TC275时钟系统由4个模块组成</p>
<ul>
<li>时钟源</li>
<li>时钟倍频</li>
<li>时钟分频</li>
<li>单独的时钟配置<br />
<img src="clock_tree.png" alt="clock tree" /></li>
</ul>
<h2 id="时钟源"><a class="markdownIt-Anchor" href="#时钟源"></a> 时钟源</h2>
<p>TC275有几种时钟源，可用于完整的设备，主要和次要的部分，或者专用的模块，这取决于来源和配置（这段没怎么看懂，以后再更改）。<br />
需要注意的是不同的时钟源可以平行用于不同的设备，但同一个外设同一时间只能使用一个时钟源。</p>
<h3 id="振荡电路"><a class="markdownIt-Anchor" href="#振荡电路"></a> 振荡电路</h3>
<p>振荡电路设计为可与外部的晶体/陶瓷谐振器或外部稳定时钟源一起工作的电路，该电路包括一个反相放大器，其输入为XTAL1，输出XTAL2为一个集成反馈电阻。</p>
<h4 id="外部时钟输入模式"><a class="markdownIt-Anchor" href="#外部时钟输入模式"></a> 外部时钟输入模式</h4>
<p>这种方式，外部时钟直接输入到XTAL1引脚，XTAL2留空，需要注意的是输入频率要大于或等于PLL VCO的输入频率（8-24MHz）,电路如下图：<br />
<img src="External_Input_Clock_Mode.png" alt="External Input Clock Mode" /></p>
<h4 id="时钟振荡电路"><a class="markdownIt-Anchor" href="#时钟振荡电路"></a> 时钟振荡电路</h4>
<p>时钟振荡电路有两种模式，带外部组件和不带外部组件。两种模式的电路图如下：<br />
<img src="external_circuitries.png" alt="external circuitries" /></p>
<h4 id="振荡电路控制寄存器"><a class="markdownIt-Anchor" href="#振荡电路控制寄存器"></a> 振荡电路控制寄存器</h4>
<p>寄存器结构如下：<br />
<img src="Oscillator_Circuit_Control_Register.png" alt="Oscillator Circuit Control Register" /><br />
在使用外部振荡器作为时钟源时，可以通过SSW（start_up）进行配置，或者在SSW执行之后进行配置。</p>
<h5 id="通过ssw进行配置"><a class="markdownIt-Anchor" href="#通过ssw进行配置"></a> 通过SSW进行配置</h5>
<p>要通过SSW配置OSCCON寄存器，必须将FLASH0_PROCOND.OSCCFG置为1。在这种模式下，SSW从FLASH0_PROCOND加载OSCCON配置数据。所需数据要与UCB_DFlash一起存在偏移0处。在此种模式下，OSCCON.MODE和OSCCON.CAPxEN以及位<br />
OSCCON.APREN是可控的。<br />
如果禁用的振荡器，则必须通过将位字段OSCCON.MODE = 00 B设置为使能振荡器。<br />
如果使用内部的电容器，则可以通过OSCCON.CAPxEN位使能。</p>
<h5 id="在ssw之后进行配置"><a class="markdownIt-Anchor" href="#在ssw之后进行配置"></a> 在SSW之后进行配置</h5>
<p>除了在SSW中进行配置之外，还可以在SSW执行之后进行配置，可直接操作OSCCON寄存器，但OSSCON受ENDINIT安全保护，在使用之前应该解除保护。</p>
<h5 id="xtal1作为一般的输入针脚"><a class="markdownIt-Anchor" href="#xtal1作为一般的输入针脚"></a> XTAL1作为一般的输入针脚</h5>
<p>通过配置OSCCON.XD1和OSCCON.X1DEN可以将XTAL1作为一般的输入针脚。<br />
XTAL2不能配置为输入针脚。</p>
<h5 id="振荡器看门狗"><a class="markdownIt-Anchor" href="#振荡器看门狗"></a> 振荡器看门狗</h5>
<p>振荡器看门狗用来检测时钟输入频率太高或者时钟输入丢失。看门狗监视来自OSC的输入时钟频率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, 在PLL预分频器模式和正常模式下，强制要求稳定且定义的输入频率。在自由运行模式下，不需要输入频率<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，因此，每次系统复位后都运行在此模式。<br />
对于正常模式，要求输入的频率在<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>在某个频率范围内，才能从VCO部件获得稳定的主时钟。<br />
期望的时钟频率由OSCCON.OSCVAL选择，看门狗OSC_WDT监视频率是否太高或太低。<br />
监视的频率是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{oscref}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>，它是通过<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>计算得出。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>f</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub><mrow><mi>O</mi><mi>S</mi><mi>C</mi><mi>V</mi><mi>A</mi><mi>L</mi><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f_{oscref} = \frac {f_{osc}} {OSCVAL + 1} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.980548em;vertical-align:-0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.14077em;vertical-align:-0.7693300000000001em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord mathdefault">A</span><span class="mord mathdefault">L</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>分频器值OSCCON.OSCVAL必须以f_{oscref}为2.5MHz的方式进行选择。<br />
注意：f_{oscref}必须在2MHz至3MHz的范围内，并且应尽可能接近2.5MHz。<br />
所以可以反推出来OSCVAL的值。<br />
整个检测步骤为：</p>
<ol>
<li>设置OSCCON.MODE = 0使能振荡器频率输入，并且不进入节能模式</li>
<li>通过上面公式算出OSCCON.OSCVAL的值。</li>
<li>设置OSCCON.OSCRES = 1来重置振荡器看门狗</li>
<li>比较OSCCON.PLLLV 和OSCCON.PLLHV是否为0来判断输入频率是否满足要求。</li>
</ol>
<h3 id="备用时钟源"><a class="markdownIt-Anchor" href="#备用时钟源"></a> 备用时钟源</h3>
<p>TC275内部提供了备用的时钟源<strong>100MHz</strong>，该时钟稳定但是可靠，可做为系统时钟。它提供的精度低于外部时钟。不能禁用或启用备用时钟，或者用其它的方式控制备用时钟。可通过CCUCON0和CCUCON1设置使用备用时钟源。</p>
<h2 id="时钟倍频"><a class="markdownIt-Anchor" href="#时钟倍频"></a> 时钟倍频</h2>
<p>典型的CPU运行速度大约是晶振的10倍。所以需要提升时钟频率。<br />
TC275提供了两个锁相环（Phase Lock Loop），PLL和PLL_ERAY。</p>
<h3 id="pll"><a class="markdownIt-Anchor" href="#pll"></a> PLL</h3>
<p>PLL将低频的外部时钟信号转换为高速的内部时钟。PLL还具有故障安全逻辑，可检测不正确的外部时钟信号，执行紧急的措施。</p>
<h4 id="pll功能描述"><a class="markdownIt-Anchor" href="#pll功能描述"></a> PLL功能描述</h4>
<p>PLL结构如下：<br />
<img src="PLL_Block_Diagram.png" alt="PLL Block Diagram" /><br />
PLL有三种可以选择的模式：</p>
<ul>
<li>一般模式</li>
<li>预分频模式</li>
<li>自由运行模式</li>
</ul>
<h5 id="一般模式"><a class="markdownIt-Anchor" href="#一般模式"></a> 一般模式</h5>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>先经过P分频，再N倍频，最后K2，K3分频产生。<br />
<img src="PLL_Normal_Mode.png" alt="PLL Normal Mode" /></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub><mo>=</mo><mfrac><mi>N</mi><mrow><mi>P</mi><mo>∗</mo><mi>K</mi><mn>2</mn></mrow></mfrac><mo>∗</mo><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL} = \frac {N} {P*K2} * f_{osc} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mn>2</mn></mrow></msub><mo>=</mo><mfrac><mi>N</mi><mrow><mi>P</mi><mo>∗</mo><mi>K</mi><mn>3</mn></mrow></mfrac><mo>∗</mo><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL2} = \frac {N} {P*K3} * f_{osc} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.04633em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>选择一般模式</p>
<ul>
<li>PLLCON0.VCOBYP = 0</li>
<li>PLLCON0.CLRFINDIS = 1<br />
确认进入预分频模式</li>
<li>PLLSTAT.FINDIS = 0</li>
<li>PLLSTAT.VCOBYST = 0</li>
<li>PLLSTAT.VCOLOCK = 1</li>
<li>OSCCON.PLLLV = 1</li>
<li>OSCCON.PLLHV = 1</li>
</ul>
<h5 id="预分频模式"><a class="markdownIt-Anchor" href="#预分频模式"></a> 预分频模式</h5>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>只经过K1分频即为预分频模式。<br />
<img src="PLL_Prescaler_Mode.png" alt="PLL Prescaler Mode" /></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub><mrow><mi>K</mi><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f_{PLL} = \frac {f_{osc}} {K2} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>选择预分频模式：</p>
<ul>
<li>PLLCON0.VCOBYP = 1<br />
判断进入预分频模式：</li>
<li>PLLSTAT.VCOBYST = 1<br />
由于使用了<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>输入频率，建议检查OSCCON.PLLLV和OSCCON.PLLHV以确定<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>输入范围是否满足。</li>
</ul>
<h5 id="自由运行模式"><a class="markdownIt-Anchor" href="#自由运行模式"></a> 自由运行模式</h5>
<p>系统复位之后就运行在自由运行模式。在这种模式下，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>被切断，由VCO（压控振荡器）产生的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mi>B</mi><mi>A</mi><mi>S</mi><mi>E</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLLBASE}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>作为系统时钟源（150MHz）,只被K2和K3分频。<br />
<img src="PLL_FreeRunning_Mode.png" alt="PLL FreeRunning Mode" /></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mi>B</mi><mi>A</mi><mi>S</mi><mi>E</mi></mrow></msub><mrow><mi>K</mi><mn>2</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f_{PLL} = \frac {f_{PLLBASE} } {K2} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mn>2</mn></mrow></msub><mo>=</mo><mfrac><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mi>B</mi><mi>A</mi><mi>S</mi><mi>E</mi></mrow></msub><mrow><mi>K</mi><mn>3</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">f_{PLL2} = \frac {f_{PLLBASE} } {K3} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord">3</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>选择自由运行模式需要设置寄存器：</p>
<ul>
<li>PLLCON0.VCOBYP = 0</li>
<li>PLLCON0.SETFINDIS = 1<br />
判断是否进入自由运行模式：</li>
<li>PLLSTAT.FINDIS = 1</li>
<li>PLLSTAT.VCOBYST = 0<br />
清除PLLCON0.OSCDISCDIS位会在VCO失锁事件时自动进入自由运行模式，以保证系统有时钟可用。</li>
</ul>
<h3 id="pll_eray"><a class="markdownIt-Anchor" href="#pll_eray"></a> PLL_ERAY</h3>
<p>略</p>
<h2 id="分频"><a class="markdownIt-Anchor" href="#分频"></a> 分频</h2>
<p>能过前两部分的配置，定义了系统的时钟，现在，要将时钟分配给单个的模块，各个CPU，和模块。以使他们都在最优的性能和功耗运行。<br />
系统分为几个子时钟域，可以分别配置时钟速度。但每个子时钟域也有一些限制。从时钟角度看，每个子时钟域都定义一个逻辑单元。<br />
时钟分配通过时钟控制单元（CCU）完成。CCU接受两个PLL（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mi mathvariant="normal">/</mi><mi>P</mi><mi>L</mi><mi>L</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL/PLL2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04964em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mtight">/</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><msub><mi>L</mi><mi>E</mi></msub><mi>R</mi><mi>A</mi><mi>Y</mi><mi mathvariant="normal">/</mi><mi>P</mi><mi>L</mi><msub><mi>L</mi><mi>E</mi></msub><mi>R</mi><mi>A</mi><mi>Y</mi><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL_ERAY/PLL_ERAY2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04964em;vertical-align:-0.3551999999999999em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.34480000000000005em;"><span style="top:-2.5198em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">/</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3551999999999999em;"><span></span></span></span></span></span></span></span></span></span>，备份时钟<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>b</mi><mi>a</mi><mi>c</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{back}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>O</mi><mi>S</mi><mi>C</mi><mn>0</mn></mrow></msub></mrow><annotation encoding="application/x-tex">f_{OSC0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，这些时钟可以直接转发也可以分频到子时钟域。<br />
TC275的时钟系统和子系统时钟输入如下<br />
<img src="TC27x_Clocking_System.png" alt="TC27x Clocking System" /></p>
<h3 id="时钟控制单元ccu"><a class="markdownIt-Anchor" href="#时钟控制单元ccu"></a> 时钟控制单元（CCU）</h3>
<p>时钟控制单元示意图如下：<br />
<img src="Clock_Control_Unit.png" alt="Clock Control Unit" /><br />
对大多数时钟，都提供了一个线性分频器，该分频器由XXXDIV字段控制。<br />
对于CPU的时钟，实现了更复杂的分频器。 这样可以更好地控制各个CPU的时钟频率变化。 这种机制可以使频率变化适应应用定义的特定电流极限。<br />
调试块还有一个固定的参考时钟REFCLK1/2，它将主时钟<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub><mi mathvariant="normal">/</mi><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi><mi>E</mi><mi>R</mi><mi>A</mi><mi>Y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL}/f_{PLLERAY}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>除以24。这使OCDS可以独立于所选的SRI和SPB时钟速度生成时间戳。</p>
<h3 id="时钟分频器的限制"><a class="markdownIt-Anchor" href="#时钟分频器的限制"></a> 时钟分频器的限制</h3>
<p>根据下表和公式<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>A</mi><mi>A</mi><mi>A</mi></mrow></msub><mo>=</mo><mi>n</mi><mo>∗</mo><msub><mi>f</mi><mrow><mi>B</mi><mi>B</mi><mi>B</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{AAA} = n*f_{BBB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight">A</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.46528em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>可以算出和设置每个模块的时钟频率。<br />
<img src="CCU_allowed_Clock_Ratios.png" alt="CCU allowed Clock Ratios" /></p>
<h3 id="ccu寄存器"><a class="markdownIt-Anchor" href="#ccu寄存器"></a> CCU寄存器</h3>
<p>系统中的任何CPU均可访问CCU寄存器。但是，建议仅使用一个CPU来控制时钟。由于CPU0是复位后的活动CPU和可用CPU，因此这是合理的选择。<br />
时钟分频涉及到的寄存器有CCUCON0,CCUCON1,CCUCON5,CCUCON2,CCUCON6,CCUCON7,CCUCON8</p>
<h3 id="各子模块默认总线频率"><a class="markdownIt-Anchor" href="#各子模块默认总线频率"></a> 各子模块默认总线频率</h3>
<h2 id="单独的时钟生成"><a class="markdownIt-Anchor" href="#单独的时钟生成"></a> 单独的时钟生成</h2>
<p>每个模块提供一些单独的时钟控制选项。 大多数模块为此提供了一个时钟控制（CLC）寄存器。</p>
<h3 id="时钟控制寄存器clc"><a class="markdownIt-Anchor" href="#时钟控制寄存器clc"></a> 时钟控制寄存器(CLC)</h3>
<p>每个模块的下面功能与CLC相关</p>
<ul>
<li>外设时钟的静态开关控制</li>
<li>休眠模式下的模块时钟行为</li>
</ul>
<h4 id="模块开关控制"><a class="markdownIt-Anchor" href="#模块开关控制"></a> 模块开关控制</h4>
<p>如果一个模块在应用中没有被使用，可以设置CLC的DISR来关闭。在外设中有一个运行模式时钟分频器RMC，另一个关闭模块的方法就是设置RMC为0。<br />
DISS位指定模块是关闭（DISS=1）还是打开（DISS=0）。<br />
禁止写入禁用的模块除CLC以外的寄存器，这将导致相应的总线控制单元（BCU）产生总线错误。读禁用模块的寄存器是允许的。<br />
启用模块时需要判断DISS是否清除，在启用过程中写入模块的其它寄存器也会引起总线错误。</p>
<h4 id="睡眠模式"><a class="markdownIt-Anchor" href="#睡眠模式"></a> 睡眠模式</h4>
<p>CLC中的EDIS指定模块是否进入睡眠模式。</p>
<h4 id="进入禁用模式"><a class="markdownIt-Anchor" href="#进入禁用模式"></a> 进入禁用模式</h4>
<p>设置DISR位，设置DISR位会有操作时间，需要判断DISS位是否置位，然后进行下一步操作。</p>
<h4 id="模块时钟分频器"><a class="markdownIt-Anchor" href="#模块时钟分频器"></a> 模块时钟分频器</h4>
<p>RMC位可以设置模块相对于<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>S</mi><mi>P</mi><mi>B</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{SPB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的时钟分频。公式如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>C</mi><mi>L</mi><mi>C</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>f</mi><mrow><mi>S</mi><mi>P</mi><mi>B</mi></mrow></msub><mrow><mi>R</mi><mi>M</mi><mi>C</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">f_{CLC} = \frac{f_{SPB}} {RMC} 
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.0574399999999997em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714399999999998em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>如果没有RMC位，模块时钟等于<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>S</mi><mi>P</mi><mi>B</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{SPB}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.<br />
下面的表列出了TC275外设的CLC位的支持情况。<br />
<img src="Clock_Generation_Implementation.png" alt="Clock Generation Implementation" /></p>
<h2 id="时钟监视"><a class="markdownIt-Anchor" href="#时钟监视"></a> 时钟监视</h2>
<p>可以设置CCUCON3，CCUCON4进行<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><msub><mi>L</mi><mi>E</mi></msub><mi>R</mi><mi>A</mi><mi>Y</mi></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>S</mi><mi>R</mi><mi>I</mi></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>S</mi><mi>P</mi><mi>B</mi></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>G</mi><mi>T</mi><mi>M</mi></mrow></msub><mo separator="true">,</mo><msub><mi>f</mi><mrow><mi>S</mi><mi>T</mi><mi>M</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL}, f_{PLL_ERAY}, f_{SRI}, f_{SPB}, f_{GTM}, f_{STM}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.944745em;vertical-align:-0.250305em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mtight"><span class="mord mathdefault mtight">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567071428571427em;margin-left:0em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.14329285714285717em;"><span></span></span></span></span></span></span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.22222em;">Y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.250305em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight" style="margin-right:0.07847em;">I</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">G</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>等时钟频率的监视。<br />
具体见手册7.1.5节</p>
<h2 id="时钟的紧急行为"><a class="markdownIt-Anchor" href="#时钟的紧急行为"></a> 时钟的紧急行为</h2>
<p>如果有时钟错误，CCU模块切换到备份时钟源<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>B</mi><mi>A</mi><mi>C</mi><mi>K</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{BACK}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05017em;">B</span><span class="mord mathdefault mtight">A</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">K</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<h2 id="外部时钟输出"><a class="markdownIt-Anchor" href="#外部时钟输出"></a> 外部时钟输出</h2>
<p>见手册7.1.7</p>
<h2 id="时钟生成单元cgu"><a class="markdownIt-Anchor" href="#时钟生成单元cgu"></a> 时钟生成单元CGU</h2>
<p><img src="Clock_Generation_Unit.png" alt="Clock Generation Unit" /><br />
系统启动时</p>
<ul>
<li>系统运行在备用时钟</li>
<li>启用振荡器OSC</li>
<li>CPU和SRI频率为100MHz</li>
<li>SPB的频率为50MHz<br />
配置时钟</li>
</ul>
<ol>
<li>等待<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi><mn>0</mn></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>稳定</li>
<li>初始化PLL，以达到目标的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>v</mi><mi>c</mi><mi>o</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{vco}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em;">v</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight">o</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>和<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>
<ul>
<li>通过CCUCON1.INSEL=1选择PLL输入时钟</li>
<li>断开输入时钟和VCO的连接，设置PLLCON0.SETFINDIS=1，即<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>o</mi><mi>s</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{osc}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span><span class="mord mathdefault mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与VCO断开，在上图的1位置，此时CCU的输入时钟<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>S</mi><mi>O</mi><mi>U</mi><mi>R</mi><mi>C</mi><mi>E</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{SOURCE}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">U</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>仍然是<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>b</mi><mi>a</mi><mi>c</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{back}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>选择P，N和K2/K3作为最终目标的VCO和PLL频率(100MHz)
<ul>
<li>P应该尽可能小(1)</li>
<li>N应该尽可能大(59)</li>
</ul>
</li>
<li>将输入的时钟连接到VCO，设置PLLCON0.CLRFINDIS=1</li>
<li>配置K2(5)，以后，可以通过更改K2配置不同的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>频率</li>
</ul>
</li>
<li>等待PLL锁定，检查PLLSTAT.VCOLOCK!=0</li>
<li>通过配置CCUCON0,CCUCON1,CCUCON5设置不同子模块的频率</li>
<li>通过CCUCON0.CLKSEL=1将CCU的输入时钟<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>S</mi><mi>O</mi><mi>U</mi><mi>R</mi><mi>C</mi><mi>E</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{SOURCE}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.05764em;">S</span><span class="mord mathdefault mtight" style="margin-right:0.02778em;">O</span><span class="mord mathdefault mtight" style="margin-right:0.10903em;">U</span><span class="mord mathdefault mtight" style="margin-right:0.00773em;">R</span><span class="mord mathdefault mtight" style="margin-right:0.07153em;">C</span><span class="mord mathdefault mtight" style="margin-right:0.05764em;">E</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>从<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>b</mi><mi>a</mi><mi>c</mi><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{back}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>切换为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></li>
<li>配置K2，逐步将<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>f</mi><mrow><mi>P</mi><mi>L</mi><mi>L</mi></mrow></msub></mrow><annotation encoding="application/x-tex">f_{PLL}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.10764em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">P</span><span class="mord mathdefault mtight">L</span><span class="mord mathdefault mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>配置为目标频率。比如100MHz,120MHz,150MHz,200MHz,以避免频率变化大太造成电流扰动，每次设置K2值之后应该等待一段时间再设置K2</li>
</ol>
<p>这里没有配置子模块的时钟，统一使用默认的配置.</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">uint16 endinitSfty_pw          = IfxScuWdt_getSafetyWatchdogPassword();</span><br><span class="line"><span class="comment">//关闭SCU的看门狗，才能进行部分寄存器的设置</span></span><br><span class="line">IfxScuWdt_clearSafetyEndinit(endinitSfty_pw);</span><br><span class="line"><span class="comment">//断开OSC1和VCO的连接，进入自由运行模式，此时频率为100MHz</span></span><br><span class="line">SCU_PLLCON0.B.SETFINDIS = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//选择PLL输入时钟，0为备份时钟，1为外部时钟，即OSC0</span></span><br><span class="line">SCU_CCUCON1.B.INSEL = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//更新CCUCON1寄存器</span></span><br><span class="line">SCU_CCUCON1.B.UP    = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//设置K2，P，N的值 PLL=(OSC0*(N+1))/((K+1)*(P+1))，此时频率为100MHz</span></span><br><span class="line">SCU_PLLCON1.B.K2DIV = <span class="number">5</span>;</span><br><span class="line">SCU_PLLCON0.B.PDIV = <span class="number">1</span>;</span><br><span class="line">SCU_PLLCON0.B.NDIV = <span class="number">59</span>;</span><br><span class="line"><span class="comment">//清除PLL的loss-of-lock失锁</span></span><br><span class="line">SCU_PLLCON0.B.OSCDISCDIS = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//清除标志位，使OSC0和VCO连接上</span></span><br><span class="line">SCU_PLLCON0.B.CLRFINDIS = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//等等VCO锁定</span></span><br><span class="line"><span class="keyword">while</span> (SCU_PLLSTAT.B.VCOLOCK == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//进入一般模式</span></span><br><span class="line">SCU_PLLCON0.B.VCOBYP = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//选择fsource的来源，0为备份时钟，1为PLL</span></span><br><span class="line">SCU_CCUCON0.B.CLKSEL = <span class="number">0x01</span>;</span><br><span class="line"><span class="comment">//现在可以通过改变K2的值设置不同的PLL频率，频率需要逐步设置到目标频率，不能上升太快</span></span><br><span class="line"><span class="keyword">while</span> (SCU_PLLSTAT.B.K2RDY == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br><span class="line">SCU_PLLCON1.B.K2DIV = <span class="number">4</span>; <span class="comment">//120MHz</span></span><br><span class="line"><span class="keyword">while</span> (SCU_PLLSTAT.B.K2RDY == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br><span class="line">SCU_PLLCON1.B.K2DIV = <span class="number">3</span>;<span class="comment">//150MHz</span></span><br><span class="line"><span class="keyword">while</span> (SCU_PLLSTAT.B.K2RDY == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">&#125;</span><br><span class="line">SCU_PLLCON1.B.K2DIV = <span class="number">2</span>;<span class="comment">//200MHz</span></span><br><span class="line"><span class="comment">//设置PLL失锁</span></span><br><span class="line">SCU_PLLCON0.B.OSCDISCDIS = <span class="number">0U</span>;</span><br><span class="line">IfxScuWdt_setSafetyEndinit(endinitSfty_pw);</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Myklory</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://blog.lnnl.top/2020/02/11/TC275%E6%97%B6%E9%92%9F%E7%B3%BB%E7%BB%9F/">http://blog.lnnl.top/2020/02/11/TC275%E6%97%B6%E9%92%9F%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.lnnl.top">年年有鱼</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/tricore/">tricore</a><a class="post-meta__tags" href="/tags/TC275/">TC275</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2020/02/11/Hexo%E5%92%8Cgithub%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81blog/"><span>Hexo和github搭建静态blog</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://w.wallhaven.cc/full/ox/wallhaven-oxv8pm.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Myklory</div><div class="framework-info"><span>驱动 - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>